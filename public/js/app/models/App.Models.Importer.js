/*<input name="data" type="hidden" value="{"variables":[{"name":"","values":[{"id":0,"key":"Ireland","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":0},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":0},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":4},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":268},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1341},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":8586},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":17598}]},{"id":1,"key":"France","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":2861},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":34736},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":39084},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":61257},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":85163},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":73631},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":157153}]},{"id":2,"key":"Belgium","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":394},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":1963},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":5720},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":4334},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":7203},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":3016},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":4817}]},{"id":3,"key":"Netherlands","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":473},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":1045},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":2842},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":15009},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":30149},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":40950},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":53063}]},{"id":4,"key":"Germany","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":3227},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":15603},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":32112},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":40553},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":57708},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":78205},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":116814}]},{"id":5,"key":"Switzerland","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":400},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":3312},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":5786},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1988},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1656},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":1277},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":4615}]},{"id":6,"key":"Italy","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":4532},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":16719},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":41641},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":35067},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":43293},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":37930},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":75500}]},{"id":7,"key":"Spain","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":463},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":2205},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":2306},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":4631},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":7088},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":9124},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":16304}]},{"id":8,"key":"Sweden","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":6},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":34},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":49},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":2080},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":3756},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":6654},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":21305}]},{"id":9,"key":"Poland","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":1},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":63},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":146},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1807},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":2062},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":3468},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":9208}]},{"id":10,"key":"Russia","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":0},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":0},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":0},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":123},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":165},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":1275},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":12367}]}]}]}">*/

var testData = '{"variables":[{"name":"var name","unit":"var unit","description": "var description", "values":[{"id":0,"key":"Ireland","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":0},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":0},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":4},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":268},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1341},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":8586},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":17598}]},{"id":1,"key":"France","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":2861},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":34736},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":39084},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":61257},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":85163},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":73631},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":157153}]},{"id":2,"key":"Belgium","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":394},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":1963},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":5720},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":4334},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":7203},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":3016},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":4817}]},{"id":3,"key":"Netherlands","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":473},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":1045},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":2842},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":15009},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":30149},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":40950},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":53063}]},{"id":4,"key":"Germany","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":3227},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":15603},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":32112},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":40553},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":57708},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":78205},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":116814}]},{"id":5,"key":"Switzerland","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":400},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":3312},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":5786},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1988},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1656},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":1277},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":4615}]},{"id":6,"key":"Italy","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":4532},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":16719},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":41641},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":35067},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":43293},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":37930},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":75500}]},{"id":7,"key":"Spain","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":463},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":2205},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":2306},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":4631},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":7088},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":9124},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":16304}]},{"id":8,"key":"Sweden","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":6},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":34},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":49},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":2080},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":3756},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":6654},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":21305}]},{"id":9,"key":"Poland","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":1},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":63},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":146},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":1807},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":2062},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":3468},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":9208}]},{"id":10,"key":"Russia","values":[{"x":{"d":"1454-01-01","l":"1454","sd":"1400-01-01","ed":"1499-12-31","td":"century"},"y":0},{"x":{"d":"1501-01-01","l":"1501","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":0},{"x":{"d":"1551-01-01","l":"1551","sd":"1500-01-01","ed":"1599-12-31","td":"century"},"y":0},{"x":{"d":"1601-01-01","l":"1601","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":123},{"x":{"d":"1651-01-01","l":"1651","sd":"1600-01-01","ed":"1699-12-31","td":"century"},"y":165},{"x":{"d":"1701-01-01","l":"1701","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":1275},{"x":{"d":"1751-01-01","l":"1751","sd":"1700-01-01","ed":"1799-12-31","td":"century"},"y":12367}]}]}]}';

;( function() {
		
	"use strict";

	App.Models.Importer = Backbone.Model.extend( {

	
		initialize: function () {

		},

		uploadFormData: function( formData ) {

			$.ajaxSetup( {
				headers: { 'X-CSRF-TOKEN': $('[name="_token"]').val() }
			} );

			formData = testData;
			console.log( formData );
			
			try {
				
				var that = this,
					json = $.parseJSON( formData ),
					variables = json.variables;

				//create import
				var inputFileData = { "rawData": testData, "fkUserId": 1 };
				var inputFileModel = new App.Models.Import.InputFileModel( inputFileData );
				inputFileModel.import();

				//create datasource
				var datasourceData = { "name": "source name", "link": "source link", "description": "source description" };
				var datasourceModel = new App.Models.Import.DatasourceModel( datasourceData );
				datasourceModel.import();

				//create dataset
				var datasetData = { "name": "dataset name", "datasetTags": [], "description": "dataset description", "categoryId": 1, "subcategoryId": 1 };
				var datasetModel = new App.Models.DatasetModel( datasetData );
				datasetModel.import();

				$.each( variables, function( i, variableData ) {

					that.createVariable( variableData );
					
				} );
			
			} catch( err ) {

				console.error( "Error uploading data", err );
			
			}

		},

		createVariable: function( variableData ) {

			if( variableData && variableData.values ) {

				//temp
				var variableType = 1;
				variableData.variableType = variableType;

				console.log( "variableData", variableData );
				var variableModel = new App.Models.VariableModel( variableData );
				console.log( "variableModel", variableModel );
				variableModel.import();

				var that = this;
				$.each( variableData.values, function( i, v ) {
					
					var entityData = v;
					that.createEntity( entityData );

				} );

			}
			
		},

		createEntity: function( entityData ) {

			console.log( "entityData", entityData );
			entityData.name = entityData.key;
			var entityModel = new App.Models.EntityModel( entityData );
			console.log( entityModel );
			entityModel.import();
		}
			
	} );

})();